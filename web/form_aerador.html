<!DOCTYPE html>

<body>

<div class="title-row">
  <h1>Aerador</h1>
</div>

<div class='button-row'>
  <button class="add_button" onclick="attElements()">Restaurar</button>
  <button class="add_button" onclick='removeAll()'>Limpar</button>
</div>

<div class='button-row'>
  <button class="add_button" onclick='addElement()'>Adcionar</button>
</div>

<form class='form-basic' name='aerador' id='tratador-agenda'>
  <div class='line-row'>
    <span>Início</span>
    <span>Fim</span>
  </div>

</form>

<script type="text/javascript">

  var i = 0; /* Set Global Variable i */
  function increment(){
  i += 1; /* Function for automatic increment of field's "Name" attribute. */
  }

  // mascara dos campos de tempo
  var timeMask = {translation: {
                    H: {pattern: /[0-2]/, optional: true},
                    h: {pattern: /[0-9]/},
                    M: {pattern: /[0-5]/},
                    m: {pattern: /[0-9]/}
                    },
                  placeholder: '__:__'
  };



  /*
  Tirado do site: https://www.formget.com/how-to-dynamically-add-and-remove-form-fields-using-javascript/
  ---------------------------------------------
  Function to Remove Form Elements Dynamically
  ---------------------------------------------

  */
  function removeElement(parentDiv, childDiv){
    if (childDiv == parentDiv){
      alert("The parent div cannot be removed.");
    }
    else if (document.getElementById(childDiv)){
      var child = document.getElementById(childDiv);
      var parent = document.getElementById(parentDiv);
      parent.removeChild(child);
    }
    else{
      alert("Child div has already been removed or does not exist.");
      return false;
    }
  }
  /*
  ----------------------------------------------------------------------------
  Functions that will be called upon, when user click on the Name text field.
  ----------------------------------------------------------------------------
  */
  function addElement(val1=null, val2=null){
    var div = document.createElement('div');
    div.setAttribute("id", "id_" + i);
    div.classList.add('line-row', 'input_field');

    var inicio = document.createElement("input");
    inicio.setAttribute("type", "text");
    inicio.setAttribute("name", "list" + i +  "_inicio");
    inicio.classList.add('input_list');
    $(inicio).mask("Hh:Mm", timeMask);
    if (val1) inicio.value = val1;

    var fim = document.createElement("input");
    fim.setAttribute("type", "text");
    fim.setAttribute("name","list" + i + "_fim");
    fim.classList.add('input_list');
    $(fim).mask("Hh:Mm", timeMask);
    if (val2) fim.value = val2;

    var close = document.createElement("img");
    close.setAttribute("onclick",
                       "removeElement('tratador-agenda','id_" + i + "')");
    close.setAttribute("src", "assets/delete.png");

    increment();

    div.appendChild(inicio);
    div.appendChild(fim);
    div.appendChild(close);

    document.getElementById("tratador-agenda").appendChild(div);
  }
  /*
  -----------------------------------------------------------------------------
  Functions that will be called upon, when user click on the Reset Button.
  ------------------------------------------------------------------------------
  */
  function removeAll(){
    $('.input_field').remove();
    i = 0;
  }

  function attElements(){
    get_status().then(

      function (msg) {
        msg = JSON.parse(msg);
        //console.log(msg);
        var elementos = msg['aerador'];

        if (elementos) {
          removeAll();
          for (var el in elementos) {
            addElement(elementos[el][0], elementos[el][1]);
          }
        }
      }, function (erro) {
        console.log(erro);
      }
    );
  }

  // Atualiza os campos depois de carregar a página
  attElements();

</script>

</body>
